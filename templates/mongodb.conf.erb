#mongodb.conf - generated from Puppet

systemLog:
  <%- if @syslog -%>
  destination: syslog
  <%- elsif @logpath -%>
  path: <%= @logpath %>
  destination: file
    <%- if @logappend -%>
  logAppend: <%= @logappend %>
    <%- end -%>
    <%- if @system_logrotate -%>
  logRotate: <%= @system_logrotate %>
    <%- end -%>
  <%- end -%>
  <%- if @verbose -%>
  quiet: false
  <%- else -%>
  quiet: true
  <%- end -%>
  <%- if @verbositylevel == "v" -%>
  verbosity: 1
  <%- elsif @verbositylevel == "vv" -%>
  verbosity: 2
  <%- elsif @verbositylevel == "vvv" -%>
  verbosity: 3
  <%- elsif @verbositylevel == "vvvv" -%>
  verbosity: 4
  <%- elsif @verbositylevel == "vvvvv" -%>
  verbosity: 5
  <%- end -%>

<% if @fork or @pidfilepath -%>
#Process Management
processManagement:
  <%- if @fork -%>
  fork: <%= @fork %>
  <%- end -%>
  <%- if @pidfilepath -%>
  pidFilePath: <%= @pidfilepath %>
  <%- end -%>
<% end -%>

storage:
  dbPath: <%= @dbpath %>
  <%- if @journal != nil -%>
  journal:
    enabled: <%= @journal %>
  <%- end -%>
  <%- if @noprealloc -%>
  preallocDataFiles: <%= !@noprealloc %>
  <%- end -%>
  <%- if @nssize -%>
  nsSize: <%= @nssize %>
  <%- end -%>
  <%- if @directoryperdb -%>
  directoryPerDB: <%= @directoryperdb %>
  <%- end -%>
  <%- if @smallfiles -%>
  smallFiles: <%= @smallfiles %>
  <%- end -%>
  <%- if @quota -%>
  quota:
    enforced: <%= @quota %>
    <%- if @quotafiles -%>
    maxFilesPerDB: <%= @quotafiles %>
    <%- end -%>
  <%- end -%>
  <%- if @storage_engine_internal -%>
  engine: <%= @storage_engine_internal %>
  <%- end -%>


security:
  <%- if @auth -%>
  authorization: enabled
  <%- else -%>
  authorization: disabled
  <%- end -%>
  <%- if @keyfile -%>
  keyFile: <%= @keyfile %>
  <%- end -%>
  <%- if @noscripting -%>
  javascriptEnabled: <%= @noscripting %>
  <%- end -%>

net:
  <%- if @ipv6 -%>
  ipv6: <%= @ipv6 %>
  <%- end -%>
  <%- if @bind_ip -%>
  bindIp:  <%= @bind_ip.join(',') %>
  <%- end -%>
  <%- if @port -%>
  port: <%= @port %>
  <%- end -%>
  <%- if @objcheck -%>
  wireObjectCheck: <%= @objcheck %>
  <%- end -%>
  <%- if @rest or ! @nohttpinterface.nil? -%>
  http:
    <%- if @rest -%>
    RESTInterfaceEnabled: true
    <%- end -%>
    <%- if ! @nohttpinterface.nil? -%>
    enabled: <%= ! @nohttpinterface %>
    <%- end -%>
  <%- end -%>
  <%- if @maxconns -%>
  maxIncomingConnections: <%= @maxconns %>
  <%- end -%>
  <%- if @tls -%>
  tls:
    mode: <%= @tls_mode %>
    certificateKeyFile: <%= @tls_key %>
    <%- if @tls_ca -%>
    CAFile: <%= @tls_ca %>
    <%- end -%>
    <%- if @tls_conn_without_cert -%>
    allowConnectionsWithoutCertificates: <%= @tls_conn_without_cert %>
    <%- end -%>
    <%- if @tls_invalid_hostnames -%>
    allowInvalidHostnames: <%= @tls_invalid_hostnames %>
  <%- end -%>
<%- end -%>

<% if @replset or @oplog_size -%>
replication:
  <% if @replset -%>
  replSetName: <%= @replset %>
  <%- end -%>
  <%- if @oplog_size -%>
  oplogSizeMB: <%= @oplog_size %>
  <%- end -%>
<% end -%>

<% if @configsvr or @shardsvr -%>
sharding:
  <%- if @configsvr -%>
  clusterRole: configsvr
  <%- end -%>
  <%- if @shardsvr -%>
  clusterRole: shardsvr
  <%- end -%>
<% end -%>

<% if @profile -%>
operationProfiling:
  <%- if @profile == "0" -%>
  mode: off
  <%- elsif @profile == "1" -%>
  mode: slowOp
  <%- elsif @profile == "2" -%>
  mode: all
  <%- end -%>
  <%- if @slowms -%>
  slowOpThresholdMs: <%= @slowms %>
  <%- end -%>
<% end -%>

<% if @set_parameter -%>
setParameter:
<% [@set_parameter].flatten.each do |v| -%>
  <%= v %>
<% end -%>
<% end -%>

<% if @config_data -%>
<% @config_data.each do |k,v| -%>
<%= k %>: <%= v %>
<% end -%>
<% end -%>
